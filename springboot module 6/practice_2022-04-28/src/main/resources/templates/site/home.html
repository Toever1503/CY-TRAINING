<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

</head>
<body>
<!-- A grey horizontal navbar that becomes vertical on small screens -->
<nav th:replace="~{/site/component/header :: header}"/>
<div th:replace="~{/site/component/header :: userCart}"/>
<div class="container main-content">
    <div>
        <div class="text-center mt-2"><b style="font-size: 25px; color: darkturquoise;">Recommend for you</b></div>
        <div class="listProducts p-4">
            <div class="listItems row">
                <div class="card col-2 p-1 shadow" th:each="product: ${latestProduct}">
                    <img class="card-img-top" th:data-id="${product.getId()}"
                         th:src="${product.image}"
                         alt="">
                    <div class="card-body p-0">
                        <div class="card-text text-center" style="font-size: 12px;" th:text="${product.name}"/>
                        <div class="price container row">
                            <div class="price_infor col-10">
                                <b class="text-danger col-6" style="float: right;" th:text="|${product.price}$|"/>
                            </div>
                        </div>
                    </div>
                    <a class="btn btn-outline-primary disable" th:data-id="${product.id}" onclick="addCart(this)"
                    >Add</a>
                </div>
            </div>
        </div>
        <div id="pagination">
            <ul class="pagination">
                <li class="page-item" th:if="${!latestProduct.isFirst()}">
                    <a class="page-link" th:data-page="${latestProduct.getNumber()-1}">Previous</a></li>
                <li th:class="|page-item ${(number-1) == latestProduct.getNumber() ? 'active' : ''}|"
                    th:each="number: ${#numbers.sequence(1, latestProduct.getTotalPages())}"><a
                        class="page-link" th:data-page="${number}" href="#" th:text="${number}"></a></li>
                <li class="page-item" th:if="${!latestProduct.isLast()}">
                    <a class="page-link" th:data-page="${latestProduct.getNumber()+2}">Next</a></li>
            </ul>

            <script>
                $('document').ready(() => {
                    function changePage(e) {
                        var page = Number(e.target.dataset.page) - 1;
                        fetch('/api/products?page=' + page)
                            .then(res => res.json())
                            .then(result => {
                                if (result.result == 'success') {
                                    const data = result.data;
                                    console.log(data);
                                    const ulList = $('#pagination ul');
                                    ulList.empty();
                                    if (!data.first)
                                        ulList
                                            .append(`<li class="page-item"><a class="page-link" data-page="${data.number}">Previous</a></li>`);
                                    for (let i = 1; i <= data.totalPages; i++)
                                        ulList
                                            .append(`<li class="page-item ${(i - 1) == data.number ? 'active' : ''}"><a class="page-link" data-page="${i}">${i}</a></li>`);
                                    if (!data.last)
                                        ulList
                                            .append(`<li class="page-item"><a class="page-link" data-page="${data.number + 1}">Next</a></li>`);
                                    document.querySelectorAll("#pagination li").forEach(item => {
                                        item.addEventListener("click", function (e) {
                                            if (e.target.className.indexOf('active') == -1) {
                                                changePage(e);
                                            }
                                        })
                                    });
                                    //    end set page again
                                    if (data.numberOfElements > 0)
                                        $('.listItems').empty().append(
                                            data.content.map(product => `
                                        <div class="card col-2 p-1 shadow">
                                            <img class="card-img-top" data-id="${product.id}"
                                                 src="${product.image}"
                                                 alt="">
                                            <div class="card-body p-0">
                                                <div class="card-text text-center" style="font-size: 12px;" text="${product.name}"/>
                                                <div class="price container row">
                                                    <div class="price_infor col-10">
                                                        <b class="text-danger col-6" style="float: right;" text="${product.price}$"/>
                                                    </div>
                                                </div>
                                            </div>
                                            <a class="btn btn-outline-primary disable" data-id="${product.id}" onclick="addCart(this)"
                                            >Add</a>
                                        </div>
                                        `)
                                        );

                                }
                            })
                            .catch(err => console.log(err));
                    };
                    document.querySelectorAll("#pagination li").forEach(item => {
                        item.addEventListener("click", function (e) {
                            if (e.target.className.indexOf('active') == -1) {
                                changePage(e);
                            }
                        })
                    });
                });

            </script>
        </div>
    </div>
</div>
</body>
</html>