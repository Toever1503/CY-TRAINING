<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body>
    <header class="bg-dark navbar-dark">
        <nav class="navbar navbar-expand-sm container">
            <div class="container-fluid">
                <a class="navbar-brand" href="/">Go to Web</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapsibleNavbar">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="collapsibleNavbar">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="#">Admin dashboard</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button"
                                data-bs-toggle="dropdown">Products</a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#">Link</a></li>
                                <li><a class="dropdown-item" href="#">Another link</a></li>
                                <li><a class="dropdown-item" href="#">A third link</a></li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button"
                                data-bs-toggle="dropdown">Users</a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#">Link</a></li>
                                <li><a class="dropdown-item" href="#">Another link</a></li>
                                <li><a class="dropdown-item" href="#">A third link</a></li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button"
                                data-bs-toggle="dropdown">Orders</a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#">Link</a></li>
                                <li><a class="dropdown-item" href="#">Another link</a></li>
                                <li><a class="dropdown-item" href="#">A third link</a></li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button"
                                data-bs-toggle="dropdown">Statistics</a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#">Link</a></li>
                                <li><a class="dropdown-item" href="#">Another link</a></li>
                                <li><a class="dropdown-item" href="#">A third link</a></li>
                            </ul>
                        </li>


                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <!-- The Modal add product -->
    <div class="modal fade" id="addProduct">
        <div class="modal-dialog">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Add New</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <form action="/api/afaf" id="product-form" class="p-2">
                    <input type="text" class="d-none" name="id">
                    <div class="mb-3 mt-3">
                        <label for="name">Name:</label>
                        <input type="text" required class="form-control" id="name" placeholder="Enter name for product"
                            name="name">
                    </div>
                    <div class="mb-3 mt-3">
                        <label for="desc">Description:</label>
                        <input type="text" class="form-control" id="desc" placeholder="Enter description for product"
                            name="description">
                    </div>

                    <div class="mb-3 mt-3">
                        <label for="price">Price:</label>
                        <input type="number" required step="0.1" class="form-control" id="price" placeholder="Enter price for product"
                            name="price">
                    </div>
                    <div class="mb-3 mt-3">
                        <label for="price">Category:</label>
                        <select class="form-select" name="category">
                            <option>1</option>
                            <option>2</option>
                          </select>
                    </div>
                    <div class="mb-3 mt-3">
                        <label for="file">Image:</label> <br>
                        <input type="text" class="d-none" name="image">
                        <img src="" alt="" style="width: 50px; height: 50px;" class="img-fluid">
                        <input type="file" accept="image/*" name="file" id="file">
                    </div>

                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary" >Create</button>
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                    </div>
                </form>
                <script>
                    $('#product-form').submit(e => {
                        e.preventDefault();
                        let form = new FormData(e.target);
                        console.log(e.target.action)
                        $.ajax({
                            url: e.target.action,
                            method: 'POST',
                            data: form,
                            processData: false,
                            contentType: false,
                            success: function (data) {
                                console.log(data);
                            },
                            error: function (err) {
                                console.log(err);
                            }
                        });
                    });
                    function resetProductModal(){
                        const form = $('#product-form');
                        form.find('img').attr('src', '');
                        form.find('input[name="id"]').val('');
                        form.find('input[name="name"]').val('');
                        form.find('input[name="description"]').val('');
                        form.find('input[name="price"]').val(0);
                        form.find('input[name="image"]').val('');
                        form.find('input[type="file"]').val(null);
                        form.find('select[name="category"]').val(1);
                    }
                    function editProduct(product){
                        resetProductModal();
                        const form = $('#product-form');
                        form[0].action = '/api/product/' + product.id;
                        form.find('img').attr('src', '');
                        form.find('input[name="id"]').val(product.id);
                        form.find('input[name="name"]').val(product.name);
                        form.find('input[name="description"]').val(product.description);
                        form.find('input[name="price"]').val(product.price);
                        form.find('input[name="image"]').val(product.image);
                        form.find('input[type="file"]').val(null);
                        form.find('select[name="category"]').val(product.category.id);
                        $('#addProduct').modal('show');
                    }
                    function deleteProduct(e){
                        e.remove();
                    }
                </script>
            </div>
        </div>
    </div>
    <div class="main-content container mt-2">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item " aria-current="page"><a href="/admin">Dashboard</a></li>
                <li class="breadcrumb-item active" aria-current="page">Products</li>
            </ol>
        </nav>

        <button class="btn btn-outline-primary p-1 mb-2" type="button" data-bs-toggle="modal"
            data-bs-target="#addProduct">Add new</button>
        <table class="table table-hover table-bordered">
            <caption class="text-center">Empty</caption>
            <thead>
                <tr>
                    <th></th>
                    <th>Name</th>
                    <th>Price</th>
                    <th>Description</th>
                    <th>Category</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr>

                </tr>
            </tbody>
        </table>
        <ul class="pagination mt-2">
            <li class="page-item" th:if="${!listProducts.isFirst()}"><a class="page-link"
                    th:href="${'?page='+ (listProducts.getNumber()-1)}">Previous</a>
            </li>
            <li th:class="|page-item ${pageIndex == listProducts.getNumber() ? 'active' : ''}|"
                th:each="pageIndex : ${#numbers.sequence( 0, __${listProducts.getTotalPages()-1}__)}"><a
                    class="page-link" th:href="|?page=${pageIndex}|" th:text="${pageIndex}"></a></li>
            <li class="page-item" th:if="${!listProducts.isLast()}"><a class="page-link"
                    th:href="${'?page='+(listProducts.getNumber()+1)}">Next</a>
            </li>
        </ul>
    </div>
</body>

</html>